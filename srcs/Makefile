# Makefile para gestionar entorno Docker Inception

# Variables
COMPOSE = docker-compose
PROJECT = inception

# Regla por defecto (si solo haces "make")
all: rebuild

# Limpieza total
clean:
	@echo " Desmontando todo..."
	-@docker stop $$(docker ps -aq) 2>/dev/null || echo "锔  No hay contenedores en ejecuci贸n."
	-@docker rm -f $$(docker ps -aq) 2>/dev/null || echo "锔  No hay contenedores para eliminar."
	-@docker rmi -f $$(docker images -aq) 2>/dev/null || echo "锔  No hay im谩genes para eliminar."
	-@docker volume rm $$(docker volume ls -q) 2>/dev/null || echo "锔  No hay vol煤menes para eliminar."
	-@docker network rm $$(docker network ls -q | grep -vE "bridge|host|none") 2>/dev/null || echo "锔  No hay redes personalizadas para eliminar."
	-@$(COMPOSE) down -v --rmi all --remove-orphans 2>/dev/null || echo "锔  Docker Compose no elimin贸 nada."
	-@docker system prune -af 2>/dev/null || echo "锔  System prune no elimin贸 nada."
	-@docker volume prune -f 2>/dev/null || echo "锔  Volume prune no elimin贸 nada."

# Construcci贸n sin cach茅
build:
	@echo " Construyendo imagen..."
	@$(COMPOSE) build --no-cache

# Levantar servicios
up:
	@echo " Levantando contenedor..."
	@$(COMPOSE) -p $(PROJECT) up -d

# Atajo: limpiar + build + up
rebuild: clean build up

# Bajar servicios
down:
	@echo " Apagando contenedor..."
	@$(COMPOSE) -p $(PROJECT) down

.PHONY: all clean build up rebuild down
